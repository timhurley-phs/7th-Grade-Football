<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHS 7th — Roster & Situational Boards</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (CDN, production builds) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <style>
    @media print { .no-print { display:none } }
    .spot { min-height: 88px }
    .chip { user-select:none }
    .click-armed .spot { outline: 2px dashed rgba(59,130,246,.5); outline-offset: -2px; }
    .spot:hover { background: rgba(59,130,246,.06) }
    .diag-ok { background:#ecfdf5; color:#065f46; border:1px solid #10b981 }
    .diag { padding:.5rem .75rem; margin:.5rem 0; border-radius:.5rem; font-size:.875rem }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="no-print max-w-6xl mx-auto px-4">
    <div id="diag" class="diag diag-ok">Diagnostics: OK — App ready</div>
  </div>

  <div id="app" class="mx-auto max-w-6xl p-4 md:p-8"></div>

  <script>
    const { useState, useEffect, useRef } = React;
    const key = (s) => `phs7_${s}`;
    const clone = (o) => JSON.parse(JSON.stringify(o));

    // ----- Seed roster (you’ll edit on the Roster tab)
    const seedRoster = [
      { name: "CONNOR", off: "X", def: "", notes: "", status: "ACTIVE" },
      { name: "NATHAN", off: "LT", def: "", notes: "", status: "ACTIVE" },
      { name: "CONNER", off: "LG", def: "", notes: "", status: "ACTIVE" },
      { name: "JAYCE", off: "C", def: "", notes: "", status: "ACTIVE" },
      { name: "CHASE", off: "RG", def: "", notes: "", status: "ACTIVE" },
      { name: "FINN", off: "RT", def: "DT", notes: "", status: "ACTIVE" },
      { name: "REIKER", off: "Y", def: "", notes: "", status: "ACTIVE" },
      { name: "HENRY", off: "H", def: "DE", notes: "", status: "ACTIVE" },
      { name: "BRAIDEN", off: "Z", def: "", notes: "", status: "ACTIVE" },
      { name: "CRUZ", off: "R", def: "FS", notes: "", status: "ACTIVE" },
      { name: "HUNTER", off: "QB", def: "SS", notes: "QB/SS", status: "ACTIVE" },
      { name: "NEVIN", off: "", def: "SC", notes: "", status: "ACTIVE" },
      { name: "DRAKE", off: "", def: "LE", notes: "", status: "ACTIVE" },
      { name: "CWL", off: "", def: "DT", notes: "", status: "ACTIVE" },
      { name: "PAYTON", off: "", def: "RE", notes: "", status: "ACTIVE" },
      { name: "GAVIN", off: "", def: "WC", notes: "", status: "ACTIVE" },
      { name: "CAMERON", off: "", def: "SAM", notes: "", status: "ACTIVE" },
      { name: "LANDO", off: "", def: "MIKE", notes: "", status: "ACTIVE" },
      { name: "KNOX", off: "", def: "WILL", notes: "", status: "ACTIVE" },
      { name: "DILLY", off: "", def: "FS", notes: "", status: "ACTIVE" },
    ];

    // ----- Packages/Layouts
    const OFF_PACKAGES = {
      "11": ["X","LT","LG","C","RG","RT","Y","H","Z","R","QB"],
      "12": ["X","LT","LG","C","RG","RT","Y","TE2","Z","R","QB"],
      "GoalLine": ["TE","LT","LG","C","RG","RT","TE2","H","Z","FB","QB"],
    };
    const DEF_PACKAGES = {
      "Base43": ["SC","LE","T1","T2","RE","WC","SAM","MIKE","WILL","SS","FS"],
      "Nickel": ["SC","LE","T1","T2","RE","STAR","WC","MIKE","WILL","SS","FS"],
      "GoalLine": ["SC","LE","T1","T2","RE","WC","SAM","MIKE","WILL","SS","FS"],
    };
    const ST_PACKAGES = {
      "Kickoff": ["K","L5","L4","L3","L2","L1","R1","R2","R3","R4","R5"],
      "Kickoff Return": ["FR","F1","F2","F3","F4","F5","B1","B2","B3","B4","KR"],
      "Punt": ["P","PP","G1","T1","C","T2","G2","W1","W2","GunnerL","GunnerR"],
      "Punt Return": ["PR","HL","HR","DL","DR","M1","M2","C1","C2","E1","E2"],
      "PAT": ["LT","LG","C","RG","RT","TE","TE2","H","K","W1","W2"],
      "Hands Team": ["H1","H2","H3","H4","H5","H6","H7","H8","H9","H10","H11"],
    };

    const spotLabels = {
      X:"X",LT:"LT",LG:"LG",C:"C",RG:"RG",RT:"RT",Y:"Y",TE:"TE",TE2:"TE2",H:"H",Z:"Z",R:"R",FB:"FB",QB:"QB",
      SC:"SC",LE:"LE",T1:"T",T2:"T",RE:"RE",WC:"WC",STAR:"STAR",SAM:"SAM",MIKE:"MIKE",WILL:"WILL",SS:"SS",FS:"FS",
      K:"K",PP:"PP",G1:"G",G2:"G",W1:"W",W2:"W",KR:"KR",PR:"PR",HL:"HL",HR:"HR",FR:"FR",
      L5:"L5",L4:"L4",L3:"L3",L2:"L2",L1:"L1",R1:"R1",R2:"R2",R3:"R3",R4:"R4",R5:"R5",
      F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",B1:"B1",B2:"B2",B3:"B3",B4:"B4",
      GunnerL:"GunnerL", GunnerR:"GunnerR", DL:"DL", DR:"DR", M1:"M1", M2:"M2", C1:"C1", C2:"C2", E1:"E1", E2:"E2",
      H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",H7:"H7",H8:"H8",H9:"H9",H10:"H10",H11:"H11"
    };

    // ----- LocalStorage helper
    function useLocalState(k, defVal){
      const [val,setVal] = useState(()=>{ const raw = localStorage.getItem(key(k)); return raw? JSON.parse(raw): defVal; });
      useEffect(()=> localStorage.setItem(key(k), JSON.stringify(val)), [k,val]);
      return [val,setVal];
    }

    // ----- Roster
    function RosterTab({ roster, setRoster }){
      const [name,setName]=useState(""); const [off,setOff]=useState(""); const [def,setDef]=useState("");
      const [notes,setNotes]=useState(""); const [status,setStatus]=useState("ACTIVE");
      const importRef = useRef(null);

      const add=()=>{ if(!name.trim())return;
        setRoster(r=>[...r,{name:name.trim().toUpperCase(),off:off.toUpperCase(),def:def.toUpperCase(),notes,status}]);
        setName("");setOff("");setDef("");setNotes(""); setStatus("ACTIVE");
      };
      const del=(i)=> setRoster(r=> r.filter((_,idx)=>idx!==i));
      const csv=()=>{ if(!roster.length)return "";
        const headers=Object.keys(roster[0]); const lines=[headers.join(",")];
        roster.forEach(r=> lines.push(headers.map(h=> String(r[h]??"").replaceAll(',',';')).join(',')));
        return lines.join('\n');
      };
      const downloadCSV=()=>{ const blob=new Blob([csv()],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='phs7_roster.csv'; a.click(); URL.revokeObjectURL(url); };
      const pickCSV=()=> importRef.current?.click();
      const importCSV=(e)=>{ const f=e.target.files?.[0]; if(!f) return;
        const reader=new FileReader();
        reader.onload=()=>{ const text=String(reader.result||""); const lines=text.split(/\r?\n/).filter(Boolean);
          const [h,...rows]=lines; const headers=h.split(',');
          const out=rows.map(line=>{ const cols=line.split(','); const obj={}; headers.forEach((hh,i)=> obj[hh.trim()]= (cols[i]||"").trim()); return obj;});
          setRoster(out);
        };
        reader.readAsText(f);
      };

      return (
        React.createElement('div',{className:'space-y-4'},
          React.createElement('div',{className:'grid grid-cols-1 md:grid-cols-6 gap-2'},
            React.createElement('input',{className:'border rounded px-3 py-2',placeholder:'Player name',value:name,onChange:e=>setName(e.target.value)}),
            React.createElement('input',{className:'border rounded px-3 py-2',placeholder:'Off pos (opt)',value:off,onChange:e=>setOff(e.target.value.toUpperCase())}),
            React.createElement('input',{className:'border rounded px-3 py-2',placeholder:'Def pos (opt)',value:def,onChange:e=>setDef(e.target.value.toUpperCase())}),
            React.createElement('select',{className:'border rounded px-3 py-2',value:status,onChange:e=>setStatus(e.target.value)},
              ['ACTIVE','QUESTIONABLE','OUT','ACADEMIC','SUSPENDED'].map(s=> React.createElement('option',{key:s,value:s},s))
            ),
            React.createElement('input',{className:'border rounded px-3 py-2',placeholder:'Notes',value:notes,onChange:e=>setNotes(e.target.value)}),
            React.createElement('button',{className:'bg-blue-600 text-white rounded px-3 py-2',onClick:add},'Add')
          ),
          React.createElement('div',{className:'max-h-96 overflow-auto border rounded-xl'},
            React.createElement('table',{className:'w-full text-sm'},
              React.createElement('thead',{className:'sticky top-0 bg-gray-50'},
                React.createElement('tr',null,
                  React.createElement('th',{className:'p-2 text-left'},'Name'),
                  React.createElement('th',{className:'p-2'},'Off'),
                  React.createElement('th',{className:'p-2'},'Def'),
                  React.createElement('th',{className:'p-2'},'Status'),
                  React.createElement('th',{className:'p-2 text-left'},'Notes'),
                  React.createElement('th',{className:'p-2'})
                )
              ),
              React.createElement('tbody',null,
                roster.map((p,i)=> React.createElement('tr',{key:i,className:'border-t'},
                  React.createElement('td',{className:'p-2 font-medium'},p.name),
                  React.createElement('td',{className:'p-2 text-center'},p.off),
                  React.createElement('td',{className:'p-2 text-center'},p.def),
                  React.createElement('td',{className:'p-2 text-center'},p.status||'ACTIVE'),
                  React.createElement('td',{className:'p-2'},p.notes),
                  React.createElement('td',{className:'p-2 text-right'},
                    React.createElement('button',{className:'px-2 py-1 text-red-600',onClick:()=>del(i)},'Delete')
                  )
                ))
              )
            )
          ),
          React.createElement('div',{className:'flex gap-2'},
            React.createElement('button',{className:'border rounded px-3 py-2',onClick:downloadCSV},'Export CSV'),
            React.createElement('button',{className:'border rounded px-3 py-2',onClick:pickCSV},'Import CSV'),
            React.createElement('input',{ref:importRef,type:'file',accept:'.csv',className:'hidden',onChange:importCSV}),
            React.createElement('button',{className:'border rounded px-3 py-2',onClick:()=>{localStorage.removeItem(key('roster')); alert('Cleared roster from this browser.'); setRoster([]);}},'Clear Stored')
          )
        )
      );
    }

    // ----- Board state helper
    function useBoard(packageMap, defaultKey, label){
      const [pkg,setPkg]=useLocalState(`${label}_pkg`, defaultKey);
      const [spots,setSpots]=useLocalState(`${label}_spots`,{}); // { spotId: {1:name,2:name}}
      const layout = packageMap[pkg];
      const reset=()=> setSpots({});
      const setAt=(spotId,name,team=1)=> setSpots((s)=> ({...s, [spotId]:{...(s[spotId]||{}), [team]:name}}));
      const swap=(a,b)=> setSpots((s)=>{ const na=clone(s[a]||{}); const nb=clone(s[b]||{}); return {...s,[a]:nb,[b]:na}; });
      return { pkg,setPkg,layout,spots,setAt,reset,swap };
    }

    // ----- A single position tile
    function Spot({ id, label, data, onDrop, onClick, isSelected }){
      const onDragOver = (e)=> e.preventDefault();
      const handleDrop = (e)=>{ e.preventDefault(); const from=e.dataTransfer.getData('text/plain'); onDrop(from,id); };

      const statusClass = (name)=>{
        try {
          const roster = JSON.parse(localStorage.getItem(key('roster')))||[];
          const p = roster.find(r=> r.name===name);
          const s = (p&&p.status)||'ACTIVE';
          if (s==='ACTIVE') return '';
          if (s==='QUESTIONABLE') return 'opacity-70';
          return 'opacity-40 line-through';
        } catch { return ''; }
      };

      const chip=(team)=> React.createElement(
        'div',
        {
          draggable:true,
          onDragStart:(e)=> e.dataTransfer.setData('text/plain', id+':'+team),
          className:'chip mt-1 rounded-full px-3 py-1 text-sm font-medium shadow border bg-white cursor-grab '+statusClass(data?.[team])
        },
        data?.[team]||'—'
      );

      return React.createElement(
        'button',
        {
          type:'button',
          onClick:()=> onClick?.(id),
          onDragOver,
          onDrop:handleDrop,
          className:`spot rounded-2xl border p-3 shadow-sm bg-white/80 flex flex-col items-center justify-center w-full ${isSelected ? 'ring-2 ring-blue-400' : ''}`
        },
        React.createElement('div',{className:'text-[10px] uppercase tracking-wide opacity-60'},label),
        chip(1),
        React.createElement('div',{className:'text-[10px] opacity-60 mt-1'},'2nd'),
        chip(2)
      );
    }

   <script>
function BoardView({ title, board, packageMap, roster }){
  const { pkg,setPkg,layout,spots,setAt,reset,swap } = board;

  const [assignName,setAssignName]=React.useState("");
  const [targetTeam,setTargetTeam]=React.useState(1);      // 1 or 2
  const [selected,setSelected]=React.useState(null);       // which tile is selected
  const [overwrite,setOverwrite]=React.useState(false);    // allow overwriting existing chips when autofilling

  const onDrop=(from,to)=>{
    if(!from) return;
    if(!from.includes(':')){ setAt(to, from.trim().toUpperCase(), 1); return;}
    const [a,team]=from.split(':'); if(a===to) return; swap(a,to);
  };

  const onTileClick=(to)=> setSelected(to);

  const doAssign = ()=>{
    if(!selected){ alert('Click a position tile first.'); return; }
    if(!assignName.trim()){ alert('Type or pick a player first.'); return; }
    setAt(selected, assignName.trim().toUpperCase(), targetTeam);
  };

  // ---------- NEW: Auto-fill from roster Off/Def prefs ----------
  function autoFillFromRoster(){
    // Decide whether we use the roster's "off" or "def" field based on the board title
    const prefKey = title.startsWith('Offense') ? 'off' : (title.startsWith('Defense') ? 'def' : null);
    if (!prefKey) { alert('Auto-fill is for Offense/Defense boards.'); return; }

    // Normalize helper
    const norm = (s)=> String(s||'').trim().toUpperCase();

    // Build candidate lists for each position: pos -> [names...]
    const pool = {}; // { POS: [player...] }
    (roster||[]).forEach(p=>{
      const pos = norm(p[prefKey]);
      if (!pos) return;
      if (!pool[pos]) pool[pos]=[];
      pool[pos].push(norm(p.name));
    });

    // Keep track of which players we’ve already used at 1st and 2nd string for fairness
    const usedFirst = new Set();
    const usedSecond = new Set();

    // Helper to get next candidate for a position that isn't yet used for that team (1st or 2nd)
    const nextCandidate = (pos, team)=>{
      const list = pool[pos] || [];
      for (const name of list) {
        if (team===1 && !usedFirst.has(name)) return name;
        if (team===2 && !usedSecond.has(name) && name !== (spots[pos]?.[1]||'')) return name;
      }
      return null;
    };

    // For each spot in the current formation layout, try to place 1st & 2nd string
    layout.forEach(pos=>{
      const posId = pos; // already in uppercase like "LT", "MIKE", "X", etc.

      // If not overwriting and there’s already someone there, skip that team slot
      const current1 = spots[posId]?.[1] || '';
      const current2 = spots[posId]?.[2] || '';

      // First string
      if (overwrite || !current1) {
        const c1 = nextCandidate(posId, 1);
        if (c1) { setAt(posId, c1, 1); usedFirst.add(c1); }
      } else if (current1) {
        usedFirst.add(current1);
      }

      // Second string (backup)
      if (overwrite || !current2) {
        const c2 = nextCandidate(posId, 2);
        if (c2) { setAt(posId, c2, 2); usedSecond.add(c2); }
      } else if (current2) {
        usedSecond.add(current2);
      }
    });

    // Optional: try to fill any remaining empty second‑string slots with “nearest” extra matches
    layout.forEach(posId=>{
      const stillEmpty2 = !(spots[posId]?.[2]);
      if (stillEmpty2) {
        const list = pool[posId] || [];
        // pick any roster name not used as 1st/2nd yet for this pos
        const alt = list.find(n => !usedSecond.has(n) && n !== (spots[posId]?.[1]||''));
        if (alt) { setAt(posId, alt, 2); usedSecond.add(alt); }
      }
    });
  }
  // ---------- END Auto-fill ----------

  const exportJSON=()=>{
    const data={pkg,spots};
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=`${title}_${pkg}.json`; a.click(); URL.revokeObjectURL(url);
  };
  const copyJSON=()=> navigator.clipboard.writeText(JSON.stringify({pkg,spots},null,2)).catch(()=>{});

  return (
    React.createElement('div',{className:'space-y-3'},
      // Toolbar
      React.createElement('div',{className:'flex flex-wrap gap-2 items-center no-print w-full'},
        React.createElement('label',{className:'font-medium'},'Package:'),
        React.createElement('select',{className:'border rounded px-2 py-1',value:pkg,onChange:e=>setPkg(e.target.value)},
          Object.keys(packageMap).map(k=> React.createElement('option',{key:k,value:k},k))
        ),

        React.createElement('div',{className:'h-6 w-px bg-slate-300 mx-1'}),

        // NEW: Auto-fill button + overwrite toggle
        React.createElement('button',{className:'bg-emerald-600 text-white rounded px-3 py-1',onClick:autoFillFromRoster},'Auto‑Fill from Roster'),
        React.createElement('label',{className:'flex items-center gap-1 text-sm'},
          React.createElement('input',{type:'checkbox',checked:overwrite,onChange:e=>setOverwrite(e.target.checked)}),
          'Overwrite existing'
        ),

        React.createElement('div',{className:'h-6 w-px bg-slate-300 mx-1'}),

        React.createElement('label',{className:'font-medium'},'Assign:'),
        React.createElement('select',{className:'border rounded px-2 py-1',value:targetTeam,onChange:e=>setTargetTeam(Number(e.target.value))},
          [1,2].map(n => React.createElement('option',{key:n,value:n}, n===1?'1st string':'2nd string'))
        ),

        // Autocomplete from roster
        React.createElement('input',{
          className:'border rounded px-2 py-1 min-w-[220px]',
          placeholder:'Type player name…',
          list:'rosterList',
          value:assignName,
          onChange:e=>setAssignName(e.target.value)
        }),
        React.createElement('datalist',{id:'rosterList'},
          (roster||[]).map(p => React.createElement('option',{key:p.name, value:String(p.name||'')}))
        ),

        // Selected spot + Assign button
        React.createElement('div',{className:'text-sm'},'Selected: ',
          React.createElement('span',{className:'font-medium'}, selected || '—')
        ),
        React.createElement('button',{className:'bg-blue-600 text-white rounded px-3 py-1',onClick:doAssign},'Assign'),

        React.createElement('div',{className:'ml-auto flex gap-2'},
          React.createElement('button',{className:'border rounded px-3 py-1',onClick:reset},'Reset Board'),
          React.createElement('button',{className:'border rounded px-3 py-1',onClick:exportJSON},'Export JSON'),
          React.createElement('button',{className:'border rounded px-3 py-1',onClick:copyJSON},'Copy JSON')
        )
      ),

      // Grid
      React.createElement('div',{className:'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3'},
        layout.map(id=> React.createElement(Spot,{
          key:id,
          id,
          label:spotLabels[id]||id,
          data:spots[id],
          onDrop,
          onClick:onTileClick,
          isSelected: selected===id
        }))
      )
    )
  );
}
</script>
